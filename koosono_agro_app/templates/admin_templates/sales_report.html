{% extends "admin_templates/base_template.html" %}
{% block title %} Sales Report {% endblock title %}
{% block main_content %}
{% load humanize %}
<div class="container-fluid bg-light py-4">
    <div class="card shadow-lg" id="additional-style">
        <div class="card-header text-center bg-white">
            <h5 id="mess" style="font-size: 14px;">
                {% if messages %}
                {% for message in messages %}

                {% if message.tags == 'error' %}
                <div class="alert alert-danger">{{ message }}</div>
                {% endif %}
                {% if message.tags == 'success' %}
                <div class="alert alert-success">{{ message }}</div>
                {% endif %}
                {% endfor %}
                {% endif %}
            </h5>
            <h5 class="mb-0 text-dark"><b><i class="fas fa-chart-line"></i> Sales Report</b></h5>
            
        </div>
        <div class="card-body">
            
            <!-- Students Table -->
            <div class="table-responsive">
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Daily Report ({{ today }})</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Total Sales</th>
                            <th>Total Profit</th>

                            <th>Total Quantity Sold</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        
                        <tr>
                            <td style="text-align: left;">{{ daily_totals.0 }}</td>
                            <td>{{ daily_totals.1 }}</td>
                            <td>{{ daily_totals.2 }}</td>
                             
                        </tr>
                        
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Products sold Today.</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Product Name</th>
                            <th>Quantity</th>

                            <th>Total Sales</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        {% for product in daily_product_quantities %}
                        <tr>
                            <td style="text-align: left;">{{ product.product__name }}</td>
                            <td>{{ product.total_quantity }}</td>
                            <td>{{ product.total_sales }}</td>
                             
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Weekly Report (Starting {{ start_of_week }})</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Total Sales</th>
                            <th>Total Profit</th>

                            <th>Total Quantity Sold</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        
                        <tr>
                            <td style="text-align: left;">{{ weekly_totals.0 }}</td>
                            <td>{{ weekly_totals.1 }}</td>
                            <td>{{ weekly_totals.2 }}</td>
                             
                        </tr>
                        
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Products sold this week.</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Product Name</th>
                            <th>Quantity</th>

                            <th>Total Sales</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        {% for product in weekly_product_quantities %}
                        <tr>
                            <td style="text-align: left;">{{ product.product__name }}</td>
                            <td>{{ product.total_quantity }}</td>
                            <td>{{ product.total_sales }}</td>
                             
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Monthly Report ({{ today|date:"F" }})</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Total Sales</th>
                            <th>Total Profit</th>

                            <th>Total Quantity Sold</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        
                        <tr>
                            <td style="text-align: left;">{{ monthly_totals.0 }}</td>
                            <td>{{ monthly_totals.1 }}</td>
                            <td>{{ monthly_totals.2 }}</td>
                             
                        </tr>
                        
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Products sold this month.</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Product Name</th>
                            <th>Quantity</th>

                            <th>Total Sales</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        {% for product in monthly_product_quantities %}
                        <tr>
                            <td style="text-align: left;">{{ product.product__name }}</td>
                            <td>{{ product.total_quantity }}</td>
                            <td>{{ product.total_sales }}</td>
                             
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Yearly Report ({{ today|date:"Y" }})</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Total Sales(GHS)</th>
                            <th>Total Profit(GHS)</th>

                            <th>Total Quantity Sold</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        
                        <tr>
                            <td style="text-align: left;">{{ yearly_totals.0|floatformat:2|intcomma }}</td>
                            <td>{{ yearly_totals.1|floatformat:2|intcomma }}</td>
                            <td>{{ yearly_totals.2 }}</td>
                             
                        </tr>
                        
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="3" style="font-size: 20px;"><b>Products sold this Year.</b></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">Product Name</th>
                            <th>Quantity</th>

                            <th>Total Sales(GHS)</th>
                            
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        {% for product in yearly_product_quantities %}
                        <tr>
                            <td style="text-align: left;">{{ product.product__name }}</td>
                            <td>{{ product.total_quantity }}</td>
                            <td>{{ product.total_sales|floatformat:2|intcomma }}</td>
                             
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <table class="table table-striped table-bordered text-center" style="font-size: 0.875rem;">
                    <thead class="table-light">
                        <tr>
                            <td class="text-center" colspan="4" style="font-size: 20px;"><b>Historical Yearly Data</b></td>
                        </tr>
                        <tr>
                            <th>Year</th>
                            <th>Total Sales (GHS)</th>
                            <th>Total Profit(GHS)</th>
                            <th>Total Quantity Sold</th>
                                        
                        </tr>
                    </thead>
                    <tbody id="feesTable">
                        {% for year_data in yearly_data %}
                            <tr>
                                <td>{{ year_data.year }}</td>
                                <td>{{ year_data.total_sales|floatformat:2|intcomma }}</td>
                                <td>{{ year_data.total_profit|floatformat:2|intcomma }}</td>
                                <td>{{ year_data.total_quantity }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
            </div>
         
        </div>
        <!--<div class="card-footer text-center">
            <a href="{% url 'homepage' %}" class="btn btn-light border border-danger">&larr; Return to Main Menu</a>
        </div>-->
    </div>
</div>

<!-- Custom Styles -->
<style>
    #additional-style {
        padding: 5px;
        max-width: 95%;
        margin-left: 60px;
    }
    .table th, .table td {
        vertical-align: middle;
        padding: 10px;
    }

    .card {
        border-radius: 8px;
        padding: 15px; /* Reduced padding */
        max-width: 90%; /* Slightly smaller card */
        margin: auto;
    }

    .form-select {
        text-align-last: center;
    }

    @media (max-width: 768px) {
        #additional-style {
            max-width: 100%;
            margin-left: 0px;
            padding: 0px;
        }

    }
</style>

{% endblock %}
